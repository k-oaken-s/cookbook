# リポジトリパターン (Repository Pattern)

## 概要

リポジトリパターンは、データアクセスロジックをビジネスロジックから分離するために使用されるデザインパターンです。このパターンは、データの取得と永続化を抽象化し、ドメインモデルとデータマッピングレイヤーとの間の仲介者として機能します。

## 目的

- データアクセスロジックをビジネスロジックから分離する
- ドメインオブジェクトへのコレクションライクなインターフェースを提供する
- データアクセスの詳細を隠蔽し、その実装を容易に変更可能にする
- テスト容易性を向上させる（モック化が容易）

## 構造

```
+----------------+      +----------------+      +----------------+
|                |      |                |      |                |
|  ドメイン層     |----->| リポジトリ    |----->| データソース    |
|  クライアント   |      | インターフェース|      | 実装           |
|                |      |                |      |                |
+----------------+      +----------------+      +----------------+
```

1. **リポジトリインターフェース**: データアクセスのための抽象インターフェース
2. **リポジトリ実装**: 具体的なデータアクセス実装（Entity Framework, Dapper, インメモリなど）
3. **ドメインエンティティ**: ビジネスモデルを表現するオブジェクト

## 利点

- データアクセスロジックの中央集権化
- ビジネスロジックとデータアクセスの関心の分離
- テスト容易性の向上（モックリポジトリを使用したユニットテストが容易）
- データアクセス実装の詳細を隠蔽（SQLクエリなど）
- データソースの変更に強いアーキテクチャ

## 欠点

- 追加の抽象化レイヤーを導入するため、複雑さが増す
- 単純なCRUD操作のためだけに使用すると、不必要なボイラープレートコードが増える可能性がある
- パフォーマンス最適化が難しくなる場合がある

## ベストプラクティス

- リポジトリを集約単位で作成する（DDDの原則に従う）
- 汎用リポジトリの過度の使用を避ける
- 複雑なクエリには仕様パターンや専用のクエリオブジェクトを組み合わせる
- Unit of Workパターンと併用して、トランザクションの一貫性を管理する
- モックリポジトリを作成して、ユニットテストに活用する

## 実装例

サンプルコードは、`./csharp/Repository.cs` ファイルを参照してください。この実装例では、以下の要素が含まれています：

- 基本的なリポジトリインターフェース
- Entity Frameworkを使用した実装
- インメモリデータストアを使用したテスト用実装
- リポジトリパターンの実際の使用例

## 関連パターン

- **Unit of Workパターン**: 複数のリポジトリ操作をトランザクション的に扱う
- **仕様（Specification）パターン**: 複雑なクエリロジックをカプセル化する
- **ファクトリパターン**: 複雑なエンティティの作成を担当
- **データマッパーパターン**: オブジェクトとデータベース間のマッピングを処理

