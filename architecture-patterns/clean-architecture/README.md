# クリーンアーキテクチャ

## 概要

クリーンアーキテクチャは、Robert C. Martin（Uncle Bob）によって提唱されたソフトウェアアーキテクチャのパターンです。このアーキテクチャは、システムを複数の同心円状の層に分け、依存関係が外側から内側へ向かうように設計されています。この依存方向の制約により、内側の層（ドメイン層）は外側の層（インフラストラクチャ層など）の実装詳細に依存せず、フレームワークや外部ツールの変更に強いシステムを実現できます。

## 主要なコンポーネント

クリーンアーキテクチャは主に以下の層から構成されています：

1. **エンティティ層（Entities）**：
   - アプリケーションの中核となるビジネスルールを含むオブジェクト
   - システム全体で最も変更が少ない部分

2. **ユースケース層（Use Cases）**：
   - アプリケーション固有のビジネスルール
   - エンティティ層を操作して特定のユースケースを実現するコード

3. **インターフェースアダプター層（Interface Adapters）**：
   - コントローラー、プレゼンター、ゲートウェイなど
   - 外部システムとユースケース層の間の仲介役

4. **フレームワークと外部ツール層（Frameworks & Drivers）**：
   - データベース、Webフレームワーク、UI、外部APIなど
   - システムの最も外側の層で、具体的な実装詳細を含む

## 依存関係のルール

クリーンアーキテクチャの最も重要な原則は、**依存関係ルール**です：

> ソースコードの依存関係は、常に外側の層から内側の層に向かって流れなければならず、内側の層は外側の層について何も知ってはならない。

この原則により、内側の層（ビジネスロジック）は外側の層（フレームワークやツール）から独立して存在でき、外側の層の変更が内側の層に影響を与えないようになります。

## 依存性の逆転の原則

内側の層が外側の層のインターフェースを定義し、外側の層がそれを実装することで、依存性の逆転が実現されます。例えば：

- ユースケース層で定義されたリポジトリインターフェース
- インフラストラクチャ層でそのインターフェースの実装を提供

## 利点

- **テスト容易性**：ビジネスロジックが外部依存から分離されているため、ユニットテストが書きやすい
- **保守性**：関心事の明確な分離により、変更の影響範囲が限定される
- **柔軟性**：フレームワークやデータベースなどの技術的要素を変更しても、ビジネスロジックに影響を与えない
- **独立したドメインモデル**：ドメインモデルが技術的制約に左右されない

## 欠点

- **複雑さの増加**：特に小規模なプロジェクトでは、オーバーヘッドが大きく感じられることがある
- **データマッピングのオーバーヘッド**：層間のデータ変換が必要になり、ボイラープレートコードが増える可能性がある
- **初期開発の遅さ**：最初のセットアップに時間がかかる

## 実装例について

この実装例では、商品管理システムのシンプルなドメインを使用して、クリーンアーキテクチャの主要概念を示しています。以下のコンポーネントが含まれています：

- **ドメイン層**：Product、Categoryなどのエンティティとビジネスルール
- **ユースケース層**：商品の作成、取得、更新など
- **インターフェースアダプター層**：コントローラーとリポジトリインターフェース
- **インフラストラクチャ層**：データベース実装とフレームワーク統合
