# ヘキサゴナルアーキテクチャ (ポート & アダプター)

## 概要

ヘキサゴナルアーキテクチャ（別名：ポート＆アダプターアーキテクチャ）は、Alistair Cockburnによって提唱されたソフトウェアアーキテクチャパターンです。このアーキテクチャの主要な目的は、アプリケーションのコア（ビジネスロジック）を外部の関心事から分離し、異なるタイプの外部システムと容易に接続できるようにすることです。

ヘキサゴンの各辺は、アプリケーションと外部世界との異なるインターフェース（ポート）を表し、アダプターは特定の技術を使ってこれらのポートを実装します。

## 主要なコンポーネント

ヘキサゴナルアーキテクチャは以下の主要なコンポーネントから構成されています：

1. **アプリケーションコア**：
   - ビジネスロジックを含む中心部分
   - 外部システムとのやり取りを定義するポートを含む

2. **ポート（Ports）**：
   - **入力ポート（プライマリポート）**：外部から内部へのリクエストを受け付けるインターフェース
   - **出力ポート（セカンダリポート）**：内部から外部への操作を定義するインターフェース

3. **アダプター（Adapters）**：
   - **プライマリアダプター（入力アダプター）**：入力ポートを使用して外部からのリクエストをアプリケーションコアに伝達する
   - **セカンダリアダプター（出力アダプター）**：出力ポートを実装し、アプリケーションコアを外部システムに接続する

## 依存関係のルール

ヘキサゴナルアーキテクチャの主要な依存関係のルールは：

> アプリケーションコアは常に中心に位置し、すべての依存関係は内側に向かって流れる。アプリケーションコアは外部の具体的な実装について何も知らない。

このルールにより、アプリケーションコアは外部技術（データベース、UI、外部サービスなど）から独立して存在できます。

## 依存性の逆転の原則

アプリケーションコアが外部システムとの連携方法（ポート）を定義し、外部コンポーネントがそれを実装（アダプター）することで、依存性の逆転が実現されます：

- アプリケーションはセカンダリポート（インターフェース）を定義する
- 外部実装（データベース、外部APIなど）がこれらのポートを実装する

## 利点

- **テスタビリティ**：外部依存をモックに置き換えやすく、ユニットテストが書きやすい
- **柔軟性**：外部システムの変更が内部に影響を与えない
- **保守性**：明確な関心事の分離により、コードが整理され理解しやすい
- **交換可能性**：特定のアダプターを他の実装に簡単に置き換えられる（例：データベース変更）
- **両方向からのアクセス**：アプリケーションは様々な入力（UI、API、CLI）と出力（データストア、サービス）に対応できる

## 欠点

- **複雑さの増加**：単純なアプリケーションでは過度に複雑になる可能性がある
- **ボイラープレートコードの増加**：インターフェースとアダプターの作成が必要
- **パフォーマンスオーバーヘッド**：レイヤー間の変換処理によるオーバーヘッドが発生する場合がある

## 実装例について

この実装例では、商品管理システムのシンプルなドメインを使用して、ヘキサゴナルアーキテクチャの主要概念を示しています。以下のコンポーネントが含まれています：

- **アプリケーションコア**：ドメインモデルとビジネスロジック
- **入力ポート**：ユースケースインターフェース
- **出力ポート**：リポジトリインターフェース
- **プライマリアダプター**：REST APIコントローラー
- **セカンダリアダプター**：データベース実装
